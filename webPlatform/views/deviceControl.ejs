<html>

<head>
        <link rel="shortcut icon " type="images/x-icon" href="/images/heatzyIcon.png">
        <meta name=”viewport” content=”width=device-width, initial-scale=1″ />
    <title>
        Control your devices
    </title>
    <meta charset="uf-8">
    
    <style type="text/css">
        .left-text {

            margin-left: 30px;
            font-size: 30px;
            margin-top: 10px;
        }
     /*    .zoneNom-text {
        font-size: 30px;
        margin-top: 10px;
        } */

        .left-image {
            margin-left: 30px;
            margin-top: 10px;
            width: 300;
            /* height: 30%; */
            
        }
        .left-zoneImage {
            margin-left: 30px;
            margin-top: 20px;
            width: 300;
            /* height: 30%; */
            
        }

        .left1-1 {
            /*background-color: green;*/
            margin-top: 2cm;
            float: left;
            margin-left: 6%;
            /*margin-right: 75%;*/
            line-height: 40px;
            width: 7cm;
            height: 5cm;
            font-size: 20px;
            top: 30%
        }
        .left{
            width: 300px;
            height: 200px;
            float: left;
            display: table;
            color: #fff;
        }
        .right{
            margin-left:340px;
            position:absolute;
            width: 100%;
            height: 100%;
            /*background-color: yellow; */
        }/* 
        .right .right_l{
            position: relative;
            height: 100%
           
        }
        .right .right_r{
            
           margin-top: 55px;
            position: relative;
            float: right;
            width: 50%;
            height: 100%;
        } */
        .image {
            position: relative;

        }

        .buttom-left-lefttop {
            width: 112px;
            height: 25px;
            margin-left: -289px;
            margin-top: 0px;
            color: red;
            position: absolute;
            
        }
        .buttom-left-leftbot {
            width: 112px;
            height: 106px;
            margin-left: -289px;
            margin-top: 25px;
            color: red;
            position: absolute;
            
        }

        
        .buttom-left-top {
            width: 62px;
            height: 78px;
            margin-left: -179px;
            margin-top: 0px;
            color: red;
            position: absolute;
            
        }

        .buttom-mid-top {
            width: 58px;
            height: 78px;
            margin-left: -115px;
            margin-top: 0px;
            color: red;
            position: absolute;
            
        }

        .buttom-right-top {
            width: 60px;
            height: 78px;
            margin-left: -60px;
            margin-top: 0px;
            color: red;
            position: absolute;
           
        }


        .buttom-right-bot {
            width: 57px;
            height: 54px;
            margin-left: -57px;
            margin-top: 77px;
            color: red;
            position: absolute;
            opacity: 1;
        }

        .buttom-mid-bot {
            width: 58px;
            height: 53px;
            margin-left: -115px;
            margin-top: 78px;
            color: red;
            position: absolute;
            opacity: 1;
        }

        .buttom-left-bot {
            background-image: url('/images/schedule_vert.png');
            width: 62px;
            height: 53px;
            margin-left: -176px;
            margin-top: 78px;
            color: red;
            position: absolute;
           
        }
        .derogJour{
            display: none;
            margin-left: 30px;
        }
        #table{
            display: none;
            margin-left: 30px;
            margin-top: 10px;
        }
        .text-head{
            margin-right: 10px;
            font-size: 100%; 
            border:none;
            width:90%;
        }
        .zoneNomtext-head{
            font-size: 20px; 
            border: none;
            width:50%;
        }
        #produitList{
        border-radius: 10px;
        border: none;
        overflow: hidden;
        width: 250px;
        margin-left: 20px;
        text-align: center;
        font-family:Arial, Helvetica, sans-serif;
        }
        #grpDeviceAjoute{
            border-radius: 10px;
            width: 150px;
            height: 30px;
            margin-top: 5px;
            text-align: center;
            font-family:Arial, Helvetica, sans-serif;
            font-size: 20px;
        }
        select option{
            height: 25px;
            font-family:Arial, Helvetica, sans-serif;
            font-size: 20;
            /* background-image: url('/images/grisBck.png') */
        }
        #confirmZone{
            align-items: center;
            border: none;
            font-family:Arial, Helvetica, sans-serif;
            margin-left: 20px;
           /*  background-image: url('/images/selectBck.png'); */
            width: 250px;
            height: 35px;
            border-radius: 10px;
            font-size: 30px;
        }
         #add{
             margin-left: 25px;
            height: 25px;
            border-radius: 10px;
        } 
        .zoneProduit{
            background-image: url('/images/zoneProduitBck.png');
            width: 289px;
        }
      .icon-left{
          height: 35px;
          width: 35px;
          margin-top: 13px;
          margin-left: 25px;
          position: absolute;
      }
      .del_btn{
          border:none;
          height: 27px; 
          width:27px;
          margin: 5 ;
          background-image: url('/images/supprimerProduit.png');
          background-repeat: no-repeat;
          position: absolute;
          
          z-index: 2;
      }
      .del_produit_btn{
        border:none;
        height: 30px; 
        width:30px;
        margin-right: 15;
        margin-top: -30px;
        background-image: url('/images/supprimerZone.png');
      }
     .del_zone_btn{
        border:none;
        height: 30px; 
        width:31px;
        float: right;
        background-image: url('/images/supprimerZone.png');
     }
      .btn2{ 
        border-radius: 10px;
        border: none;
        margin: 4;
        width: 30px;
        height:30px;
        background-image: url('/images/plus.png');
      }
      fieldset{
          border-radius:10px;
      }
    </style>
    <script src="javascripts/websocket.js" type="text/javascript"></script>
    <script src="javascripts/deviceControlJS.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>
     var deviceHostS= '<%=deviceHost%>' ;
           var deviceIDS = '<%=devicesList%>';
           var deviceID = deviceIDS.split(",");
           var deviceHost = deviceHostS.split(",");
           var nicknameListS = '<%= nicknameList%>';
           var nicknameList = nicknameListS.split(",");
           var token = '<%=tokenPost%>';
           var uid = '<%=uid%>';
           var grpIdS = '<%= grpId%>';
           var grpNameS = '<%= grpName%>';
           var grpDevicesS = '<%= grpDevices%>';
           var grpDevicesIdS = '<%= grpDevicesId%>';
           var grpId = grpIdS.split(',');
           var grpName = grpNameS.split(',');
           var grpDevicesId = grpDevicesIdS.split(",");
           var grpDevices = grpDevicesS.split(",");
           console.log(grpDevicesId);
            /* for(var i=0;i<groupDevicesIDList.length;i++){
                var reg = new RegExp("\-");
                console.log(groupDevicesList[i]);    
                if(reg.test(groupDevicesList[i])){
                   groupDevicesListArray[i] = groupDevicesList[i].split('-');
                   groupDevicesIDListArray[i] = groupDevicesIDList[i].split('-');
                            
                }
                else{
                    groupDevicesListArray[i] = '';
                    groupDevicesIDListArray[i] = groupDevicesIDList[i];
                } 
           }  
           console.log(groupDevicesListArrayS,groupDevicesIDListArrayS);   */
           var message = '<%= err%>';
           //var ws = new WebSocket("ws://"+deviceHost+":8080/ws/app/v1");
          
           var sandbox = [];
           var m2m = [];
           var modeR;
           var didR;

           </script>
</head>

<body onload="prepare();modifyPosition()">
    <div id="header">
        <h1 >
            <div align="center">
            <img onclick="connectH()" src="/images/HEATZY_LOGO.png" alt="heatzy-logo" />
       </div>
            <div>
                <input type="button" name="add" id="add" value="ajouter une zone">
            </div>
            <hr />
        
        </h1>
        </div>
      
        
            <div class="left" id="left">
            <% for(var i=0; i< devicesList.length;i++){%>
                <form action='deviceControl?token=<%= tokenPost %>&uid=<%= uid %>' method="post" id='<%= nicknameList[i] %>'>
                    <div class="left-text">
                        
                        <input type="text"  id='<%= devicesList[i] %>' value='<%= nicknameList[i] %>' onchange="changeNom(this)" style="font-size: 100%; border:none;width:90%" />
                        
                    </div>
                    <div class="left-image">
                        <img class="image" src="/images/produit1.png" id='<%= devicesList[i] %>' alt='<%= nicknameList[i] %>' />
                        
                        <img  src="/images/stop_gris.png" id='<%= devicesList[i] %>|stop' name="<%= devicesList[i] %>|stop" onclick ="writeH(this.name)" class="buttom-left-lefttop" value=<%= devicesList[i] %>|2>
                        <img  src="/images/heatzy_gris.png" id='<%= devicesList[i] %>|heatzy' name="<%= devicesList[i] %>|heatzy" class="buttom-left-leftbot">
                        <img  src="/images/confort_gri.png" id='<%= devicesList[i] %>|cft' name="<%= devicesList[i] %>|cft" onclick ="writeH(this.name)" class="buttom-left-top"  value=<%= devicesList[i] %>|0>
                        <img src="/images/nuit_gri.png" id="<%= devicesList[i] %>|eco" name="<%= devicesList[i] %>|eco" onclick ="writeH(this.name)" class="buttom-mid-top" width="50px" height="50px" value=<%= devicesList[i] %>|1>
                        <img src="/images/hg_gri.png" id="<%= devicesList[i] %>|fro" name="<%= devicesList[i] %>|fro" onclick ="writeH(this.name)" class="buttom-right-top"  value=<%= devicesList[i] %>|2>
                    
                        
                        <img style="opacity:1" src="/images/vacances_gris.png" id='<%= devicesList[i] %>|derog_mode' name="<%= devicesList[i] %>|derog_mode" onclick ="writeH(this.name)" class="buttom-mid-bot"  value=<%= devicesList[i] %>>
                        <img style="opacity:1" src="/images/lock_gris.png" id='<%= devicesList[i] %>|lock_switch' name="<%= devicesList[i] %>|lock_switch" onclick ="writeH(this.name)" class="buttom-right-bot"  value=<%= devicesList[i] %>|0>
                        <!-- <button id="schedule" name="schedule" class="buttom-left-bot" type="submit" onclick="setCookie('<%= devicesList[i] %>','<%= devicesList[i] %>',1)" value=<%= devicesList[i] %>|<%= nicknameList[i] %>> -->
                        <button style="opacity:0;border: none;" id='<%= devicesList[i] %>|schedule'  name='schedule' type="submit" class="buttom-left-bot" type="button" value='<%= devicesList[i] %>|<%= nicknameList[i] %>|<%= tokenPost%>|<%= uid%>' >
                           
                        </button>
                    </div>
                </form>
                    <form id='<%= devicesList[i] %>|derogJour' class="derogJour" align=center>
                        <input type=button value="-" onClick="minus(this)" style="border-radius:10px;">
                        <input type=text name=amount value=1 style="width:30px"> <a style="color:black;">jours</a>
                        <input type=button value="+" onClick="add(this)" style="border-radius:10px;">
                        <input type="button" value="confirmer" onclick="writeH('<%= devicesList[i] %>|'+this.form.amount.value)" style="border-radius:10px;">
                    </form>
        <%}%>
 </div>

 <div class="right" id="right">
     <div class="right_l" style="display: inline-block;">
            <% for(var i=0; i< grpId.length;i++){
                if(grpId[i]!==undefined){%>
                <div style="float: left;margin:0 20px;">   
                    <fieldset >
                     <form id='<%=  grpDevicesId[grpId[i]][0] %>|derogJour' class="derogJour">
                         
                        <input type="button" value="annuler" onclick="writeG('<%=  grpDevicesId[grpId[i]][0] %>|0')" style="border-radius:10px;">
                        <input type=button value="-" onclick="minus(this)" style="border-radius:10px;">
                        <input type=text name=amount value=1 style="width:30px"> <a style="color:black;">jours</a>
                        <input type=button value="+" onClick="add(this)" style="border-radius:10px;">
                        <input type="button" value="confirmer" onclick="writeG('<%=  grpDevicesId[grpId[i]] %>|'+this.form.amount.value)" style="border-radius:10px;">
                    </form> 
                <form action='deviceControl?token=<%= tokenPost %>&uid=<%= uid %>' method="post" id='<%= grpId[i] %>' name='<%= grpName[i] %>'>
                    
                    <div class="zoneNom-text">
                        <input type="text"  id='<%= grpDevicesId[i] %>' value='<%= grpName[i] %>' onchange="changeGrpNom(this)" class="zoneNomtext-head" />
                        <input type="button" name='<%= grpDevicesId[i] %>' onclick="putBindingZone(this)" class="del_zone_btn"/>
                    </div>
                    <div class="left-zoneImage">
                        <img class="image" src="/images/produit1.png" id='<%= grpDevicesId[grpId[i]] %>' alt='<%= nicknameList[i] %>' />
                        
                        <img  src="/images/stop_vert.png" id='<%= grpDevicesId[grpId[i]][0] %>|stop' name="<%= grpDevicesId[grpId[i]] %>|stop" onclick ="writeG(this.name)" class="buttom-left-lefttop" value=<%= devicesList[i] %>|2>
                        <img  src="/images/heatzy_vert.png" id='<%= grpDevicesId[grpId[i]][0] %>|heatzy' name="<%= grpDevicesId[grpId[i]] %>|heatzy" class="buttom-left-leftbot">
                        <img  src="/images/confort_gri.png" id='<%= grpDevicesId[grpId[i]][0] %>|cft' name="<%= grpDevicesId[grpId[i]] %>|cft" onclick ="writeG(this.name)" class="buttom-left-top"  value=<%= devicesList[i] %>|0>
                        <img src="/images/nuit_gri.png" id="<%= grpDevicesId[grpId[i]][0] %>|eco" name="<%= grpDevicesId[grpId[i]] %>|eco" onclick ="writeG(this.name)" class="buttom-mid-top" width="50px" height="50px" value=<%= devicesList[i] %>|1>
                        <img src="/images/hg_gri.png" id="<%= grpDevicesId[grpId[i]][0] %>|fro" name="<%= grpDevicesId[grpId[i]] %>|fro" onclick ="writeG(this.name)" class="buttom-right-top"  value=<%= devicesList[i] %>|2>
                    
                        
                        <img style="opacity:1" src="/images/vacances_gris.png" id='<%= grpDevicesId[grpId[i]][0] %>|derog_mode' name="<%= grpDevicesId[grpId[i]] %>|derog_mode" onclick ="writeG(this.name)" class="buttom-mid-bot"  value=<%= devicesList[i] %>>
                        <img style="opacity:1" src="/images/lock_gris.png" id='<%= grpDevicesId[grpId[i]][0] %>|lock_switch' name="<%= grpDevicesId[grpId[i]] %>|lock_switch" onclick ="writeG(this.name)" class="buttom-right-bot"  value=<%= devicesList[i] %>|0>
                        <!-- <button id="schedule" name="schedule" class="buttom-left-bot" type="submit" onclick="setCookie('<%= devicesList[i] %>','<%= devicesList[i] %>',1)" value=<%= devicesList[i] %>|<%= nicknameList[i] %>> -->
                        <button style="opacity:0;border: none;" id='<%= grpDevicesId[grpId[i]][0] %>|schedule'  name='schedule' type="submit" class="buttom-left-bot" value='<%= grpDevicesId[grpId[i]] %>|<%= grpName[i] %>|<%= tokenPost%>|<%= uid%>' >
                           
                        </button>
                        <div>
                            <button type="button" class="btn2" id='<%= grpDevicesId[grpId[i]][0] %>' onclick="createSel(this)" alt="ajouter"></button>        
                            <% for(var j=0; j< grpDevices[grpId[i]].length;j++){ %>
                                <div class="zoneProduit" >
                               <!--  <img class="icon-left" /> -->
                                <img src="/images/heatzyZone_gris.png" class="icon-left" id='<%= grpDevicesId[grpId[i]][j] %>|heatzyZone' name='<%= grpDevicesId[grpId[i]][j] %>|heatzyZone'/>
                                <input type="text" id='<%= grpDevicesId[grpId[i]][j] %>' value='<%= grpDevices[grpId[i]][j] %>' onchange="changeNom(this)" style="border:none;height: 59px; width:169px;margin-left:80px;text-align:right;background-image: url('/images/selectBck.png');" />
                                <button class="del_btn" name='<%= grpDevicesId[grpId[i]][j] %>' onclick="putBinding(this)"></button>
                                </div>
                            <%}%>
                    </div>
                    </div>
                </form>

                   
                </fieldset>
                </div>
        <%}
    }%> 
</div>   
    <div style="display: inline-block;vertical-align: top;">
    <form action='deviceControl?token=<%= tokenPost %>&uid=<%= uid %>' method="post" name="zoneForm" class="zoneNomleft-text" >
       <fieldset id="fieldAjout" style="display:none;">
        <input type="text" placeholder="Zone" name='nomZone' class="zoneNomtext-head" id='nomZone' style="display: none;" >
        <img src="/images/supprimerZone.png" id="annulerZone" style="display: none;float: right;height: 30px;width: 30px;"  />
        <table id="table">
            <tr>
                <th>
                        <img class="image" src="/images/produit_colore.png" />
                </th>
            </tr>
            <tr>
                <td>
        
                </td>
            </tr>
        </table>
        <div align:center; style="margin-left: 30px;">
        <select id="produitList" name="produitList" value='<%= tokenPost%>' multiple="multiple" style="display: none;">
                <% for(var i=0; i< devicesList.length;i++){%>
                <option value='<%= devicesList[i] %>|<%= grpId.length %>|<%= uid %>' id='<%= nicknameList[i] %>'>
                       <%= nicknameList[i] %>
                </option>
                <%}%>
            </select>
        </br>
    </br>
            <input type="submit" id="confirmZone" style="display: none;" value="valider">
        </div>
        </fieldset>      
</form>
</div>
     </div>
     </div>

 
</body>
<script>
    $(document).ready(function(){
    $("#add").click(function(){
        console.log($("#produitList").css("display"),($("#produitList option")).length);
        if(($("#produitList option")).length == 0){
            alert("Pas de produit à ajouter !");
        }else{
             if($("#produitList").css("display")=='none'){
            $("#table").show();
            $("#annulerZone").show();
            $("#produitList").css('height',$("#produitList option").length*25);
            $("#produitList").show();
            $("#confirmZone").show();
            $("#nomZone").show();
            $("#fieldAjout").show();
        }
        }
       
    })
    $("#annulerZone").click(function(){
        $("#table").hide();
            $("#annulerZone").hide();
            $("#produitList").hide();
            $("#confirmZone").hide();
            $("#nomZone").hide();
            $("#fieldAjout").hide();
    })
    });
    
function addZone(){
    /* var data = {
        zoneName : $('[nameZone]').val()
    }
    console.log(data);
    $.ajax({
            //几个参数需要注意一下
                type: "POST",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "/deviceControl?token="+token ,//url
                data:data,
                success: function (result) {
                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.resultCode == 200) {
                        alert("SUCCESS");
                    }
                    ;
                },
                error : function() {
                    alert("异常！");
                }
            });  */
    var productSelected = [];
    var tbody = table.tBodies[0];
    var produitList = document.getElementById("produitList");
    var buttonAjoute = document.getElementById("add");
    console.log(buttonAjoute.value);
    var indexProduit = produitList.selectedIndex;
    var b = produitList.options;
    console.log(produitList,b);
    for(var i =0;i<b.length;i++)
{
    if(b[i].selected)
    {   //create a table to organize zones
       var productSelectedElem = document.getElementById(b[i].id);
       console.log(indexProduit);
       var productDiv = document.getElementById("left");
       productDiv.removeChild(productSelectedElem);
       
       for(var k = 0; k < tbody.rows.length; k++){
                      var r = tbody.rows[k];
                      console.log(r);
                      var tds = r.cells;
                      console.log(tds);
                      for(var j = 0; j <tds.length;j++){
                          if(tds[j].innerHTML.indexOf( nicknameList[i])!=-1){
                              tbody.deleteRow(r.rowIndex);
                              break;
                          }
                      }
                  }
                  var tr = tbody.insertRow(tbody.rows.length - 1);
                  var io =  nicknameList [i];
                  console.log(nicknameList );
                      var td = tr.insertCell(tr.cells.length);
                      console.log(td);
                      td.innerHTML = io;
    }

}   
}

   

</script>
</html>